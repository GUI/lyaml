# Lua is not officially supported, but an erlang environment will do.
language: erlang

env:
  matrix:
    - LUA=lua5.1
    - LUA=lua5.2
    - LUA=luajit-2.0.0-beta9
  global:
    - LUAROCKS_CONFIG=luarocks-config.lua
    - LUAROCKS_BASE=luarocks-2.0.12

# Tool setup.
install:
  - sudo apt-get install luajit
  - sudo apt-get install libluajit-5.1-dev
  - sudo apt-get install lua5.1
  - sudo apt-get install liblua5.1-dev
  - sudo apt-get install lua5.2
  - sudo apt-get install liblua5.2-dev

# Configure and build.
script:
  - wget http://luarocks.org/releases/$LUAROCKS_BASE.tar.gz
  - tar zxvpf $LUAROCKS_BASE.tar.gz
  - cd $LUAROCKS_BASE; ./configure --prefix=$HOME; make all install
  - ./bootstrap
  - ./configure LUA="$LUA"
  - make LUA="$LUA" LUA_INCDIR="/usr/include/$LUA" luarocks-config.lua
  - $LUA $HOME/bin/luarocks install stdlib
  - eval `$LUA $HOME/bin/luarocks path`; make rockspecs
  - $LUA $HOME/bin/luarocks make lyaml-git-1.rockspec
